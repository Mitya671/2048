<!DOCTYPE html>
<html>
    <head>
        <meta charset = "utf 8">
        <title >based</title>
        <link rel = "stylesheet" href = "2048.css">

 </head>
 <body>


    <h1>2048</h1>
    <hr>
    <h2>Score: <span id="score">0</span></h2>
    <div id="field">
    <div id="endGame" class = "display">
        <div class="gameOver">Конец игры</div>
        <div class="button">НАЧАТЬ ЗАНОВО</div>
    </div>
    </div>















 <script>
let button = document.querySelector('.button');
let score = document.querySelector('#score');
let body = document.querySelector('body');
let field = document.querySelector('#field');
let rows = 4;
let columns = 4;
let board = [
    [0,0,0,0],
    [0,0,0,0],
    [0,0,0,0],
    [0,0,0,0],
]
window.addEventListener('onload', setgame());
function setgame() {
    for(let r = 0; r<rows; r++) {
        for(let c = 0; c<columns; c++) {
            let tile = document.createElement('div');
            tile.id = r.toString() + '-' + c.toString();
            tile.classList.add('tile');
            field.append(tile)
        }
    }
}
updateTiles();
function updateTiles() {
    for(let r = 0; r<rows; r++) {
        for(let c = 0; c<columns; c++) {
            let tile = document.getElementById(r.toString()+'-'+c.toString());
            tile.innerHTML = '';
            tile.classList.value = '';
            tile.classList.add('tile');
            tile.classList.add('x'+board[r][c].toString());
            if (board[r][c]!=0){
            tile.innerHTML = board[r][c].toString();
        }
        }
    }
}
addNum();
addNum();
let oldBoard = [];
oldBoard = Object.assign(oldBoard, board);


button.addEventListener('click', reload);



body.addEventListener('keyup', turn);




function turn() {
    if (event.code == 'ArrowLeft') {
        turnLeft();
        check();
        isEndGame();
    }
    if (event.code == 'ArrowRight') {
        turnRight();
        check();
        isEndGame();
    }
    if (event.code == 'ArrowDown') {
        turnDown();
        check();
        isEndGame();
    }
    if (event.code == 'ArrowUp') {
        turnUp();
        check();
        isEndGame();
    }
}

function check () {
    let flag = true;
    for(let i=0; i<4; i++) {
        for(let j=0; j<4; j++) {
            if (board[i][j] != oldBoard[i][j]) {
                flag = false;
                break;
            }
        }
    }
    if (flag == false) {        
        afterTurn();
        addNum();
        oldBoard = Object.assign(oldBoard, board);
    }
    else {
        return;
    }
}




function turnLeft(){
    filterZero();
    for(let i=0; i<board.length; i++) {
        for (let j=0; j<board[i].length; j++) {
            if (board[i][j]==board[i][j+1]) {
                board[i][j]=board[i][j]*2;
                board[i][j+1]=0;
                score.innerHTML = Number(score.innerHTML) + board[i][j];
            }
        }
    }
    filterZero();
    addZeros();
}

function turnRight(){
    filterZero();
    boardReverse();
    for(let i=0; i<board.length; i++) {
        for (let j=0; j<board[i].length; j++) {
            if (board[i][j]==board[i][j+1]) {
                board[i][j]=board[i][j]*2;
                board[i][j+1]=0;
                score.innerHTML = Number(score.innerHTML) + board[i][j];
            }
        }
    }
    filterZero();
    addZeros();
    boardReverse();
}

function turnDown() {
    boardDown();
    filterZero();
    for(let i=0; i<board.length; i++) {
        for (let j=0; j<board[i].length; j++) {
            if (board[i][j]==board[i][j+1]) {
                board[i][j]=board[i][j]*2;
                board[i][j+1]=0;
                score.innerHTML = Number(score.innerHTML) + board[i][j];
            }
        }
    }
    filterZero();
    addZeros();
    boardUp();
}

function turnUp() {
    boardUp();
    filterZero();
    for(let i=0; i<board.length; i++) {
        for (let j=0; j<board[i].length; j++) {
            if (board[i][j]==board[i][j+1]) {
                board[i][j]=board[i][j]*2;
                board[i][j+1]=0;
                score.innerHTML = Number(score.innerHTML) + board[i][j];
            }
        }
    }
    filterZero();
    addZeros();
    boardDown();
}









function boardReverse() {
    for( let i of board) {
        i.reverse();
    }
}



function filterZero(){
    for (let i=0; i<4; i++){
    board[i] = board[i].filter(function(elem){return elem!=0})
    }
}

function addZeros(){
   for (let i of board) {
        while (i.length<4) {
            i.push(0);
        }
   }
}

function afterTurn () {
    for(let r = 0; r<rows; r++) {
        for(let c = 0; c<columns; c++) {
            let tile = document.getElementById(r.toString()+'-'+c.toString());
            tile.innerHTML=''
            if (board[r][c]!=0){
            tile.innerHTML = board[r][c];
        }
            tile.classList.value='tile';
            tile.classList.add('x'+board[r][c].toString())
        }
    }
}

function boardDown() {
    let newBoard = [];
    for (let i=0; i<columns; i++) {
        let newRow = [];
        for (let j=3; j>=0; j--) {
            newRow.push(board[j][i]);
        }
        newBoard.push(newRow);
    }
    board = newBoard;
}

function boardUp() {
    let newBoard = [];
    for (let i=3; i>=0; i--) {
        let newRow = [];
        for (let j=0; j<columns; j++) {
            newRow.push(board[j][i]);
        }
        newBoard.push(newRow);
    }
    board = newBoard;

}




function addNum() {
    let arr = [];
    for (let i = 0; i<rows; i++) {
        for (let j = 0; j<columns; j++) {
            let bee = [];
            if (board[i][j]==0) {
                bee.push(i,j);
                arr.push(bee);
            }
        }
    }
    let randomTile=0;
    if (arr.length>1) {
        randomTile = function getRandomInt(min, max) {
	return Math.floor(Math.random() * (max - min + 1)) + min;
}(0,arr.length-1)
    }

    let randomNum = function getRandomInt(min, max) {
	return Math.floor(Math.random() * (max - min + 1)) + min;
}(1,10)


    let r = arr[randomTile][0];
    let c = arr[randomTile][1];
    if (randomNum==10) {
    board[r][c] = 4} else {
        board[r][c] = 2
    };
    afterTurn();
}


function isEndGame() {
    for (let i=0;i<4;i++) {
        for (let j=0 ; j<4; j++) {
        if (board[i][j]==0) {
            return;}
        }
    }
            let oldScore = Number(score.innerHTML);
            turnDown();
            turnLeft();
            turnRight();
            turnUp();
            score.innerHTML = oldScore;
            let flag = true;
            for(let r=0; r<4; r++) {
                for(let c=0; c<4; c++) {
                    if (board[r][c] != oldBoard[r][c]) {
                        flag = false;
                        break;
            }
        }
    }
    if (flag == false) {        
        board = Object.assign(board, oldBoard);
    }
    else {
        let a = document.getElementById('endGame');
        a.classList.remove('display');
    }
        }


    function reload() {
        for(let r = 0; r<rows; r++) {
        for(let c = 0; c<columns; c++) {
            board[r][c]=0;
            let tile = document.getElementById(r.toString()+'-'+c.toString());
            tile.innerHTML=''
            tile.classList.value='tile';
            score.innerHTML = 0;
        }
    }
        let a = document.getElementById('endGame');
        a.classList.add('display');
        addNum();
        addNum();
    }












































 </script>
</body>
</html>